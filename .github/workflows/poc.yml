name: ğŸš€ Manual Salesforce Deployment

# 1. Manual Trigger Configuration
on:
  workflow_dispatch:
    inputs:
      target_org_alias:
        description: "Salesforce target org alias (e.g., SandboxName)"
        required: true
        default: "dev"
      test_level:
        description: "Deployment Test Level"
        required: true
        type: choice
        options:
          - NoTestRun
          - RunLocalTests
          - RunAllTestsInOrg

jobs:
  deploy:
    runs-on: ubuntu-latest

    environment: Prod

    # 2. Branch Selection and Conditional Run
    # This prevents the workflow from continuing if the selected branch doesn't exist
    # and ensures the checkout step uses the manually selected branch.
    steps:
      - name: âš™ï¸ Checkout specified branch
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          ref: main

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "24" # Use a recent stable Node.js version

      - name: ğŸ’¾ Install Salesforce CLI and Plugins
        run: |
          npm install -g @salesforce/cli
          # Install the sfdx-git-delta plugin
          echo "y" | sf plugins install sfdx-git-delta
